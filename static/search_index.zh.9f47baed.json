[{"title":"Hooks","content":"## 安装\n\n```bash\nnpm install @fairys/hooks # yarn add @fairys/hooks # pnpm add @fairys/hooks\n```\n","routePath":"/hooks/","lang":"zh","toc":[{"id":"安装","text":"安装","depth":2,"charIndex":0}],"frontmatter":{"title":"Hooks","overview":true},"version":""},{"title":"页面数据实例","content":"## 安装\n\n```bash\nnpm install @fairys/hooks # yarn add @fairys/hooks  # pnpm add @fairys/hooks\n```\n\n## 引入\n\n```ts\nimport { \n  FairysPageDataInstance,\n  useFairysPageDataInstance,\n  FairysPageDataInstanceContext,\n  useFairysPageDataInstanceContext,\n  useFairysPageDataInstanceStore,\n  useFairysPageDataInstanceTableProps,\n  useFairysPageDataInstanceSearchProps,\n  useFairysPageDataInstanceSnapshot,\n  useFairysPageDataInstanceEditFormProps\n} from '@fairys/hooks';\n```\n\n## 类型\n\n```ts\n\n/**\n * 页面数据状态数据类型\n */\nexport interface FairysPageDataInstanceState {\n    /**编辑表单数据*/\n    editFormData?: Record<string, any>;\n    /**编辑类型*/\n    editType?: string;\n    /**编辑弹窗是否可见*/\n    editVisible?: boolean;\n    /**加载状态*/\n    loading?: Record<string, boolean>;\n    /**查询表单数据*/\n    search?: Record<string, any>;\n    /**查询数据列表*/\n    dataList?: Record<string, any>[];\n    selectedRows?: any[];\n    selectedRowKeys?: React.Key[];\n    page?: number;\n    /**分页大小*/\n    pageSize?: number;\n    /**数据总数*/\n    total?: number;\n    /**tab键值*/\n    tabKey?: string;\n    /**是否为tab表格*/\n    isTabTable?: boolean;\n    /**是否为tab查询*/\n    isTabSearch?: boolean;\n    /**tab查询数据*/\n    tabSearch?: Record<string, Record<string, any>>;\n    /**tab数据列表*/\n    tabDataList?: Record<string, Record<string, any>[]>;\n    /**tab分页数据*/\n    tabPage?: Record<string, number>;\n    /**tab分页大小*/\n    tabPageSize?: Record<string, number>;\n    /**tab数据总数*/\n    tabTotal?: Record<string, number>;\n    /**tab选择行数据*/\n    tabSelectedRows?: Record<string, any[]>;\n    /**tab选择行数据键值*/\n    tabSelectedRowKeys?: Record<string, React.Key[]>;\n    [key: string]: any;\n}\n/**\n * 页面数据状态实例参数类型\n */\nexport interface FairysPageDataInstanceOptions extends FairysPageDataInstanceState {\n    /**请求之前处理参数*/\n    onBefore?: FairysPageDataInstance['onBefore'];\n    /**获取数据列表方法*/\n    getList?: FairysPageDataInstance['getList'];\n    /**重置获取值的方法*/\n    getResetValues?: FairysPageDataInstance['getResetValues'];\n    [key: string]: any;\n}\n\n/**\n * 页面数据实例\n */\nexport declare class FairysPageDataInstance<T extends FairysPageDataInstanceState = FairysPageDataInstanceState> {\n    /**创建ref对象*/\n    ref: <D extends Object>(value: D) => D & {\n        $$valtioSnapshot: D;\n    };\n    /**实例参数*/\n    _options: FairysPageDataInstanceOptions;\n    /**默认状态*/\n    get defaultStore(): T;\n    /**状态*/\n    store: T;\n    /**请求之前处理参数*/\n    onBefore?: (payload: Record<string, any>, instance: FairysPageDataInstance) => Record<string, any>;\n    /**获取数据列表方法*/\n    getList?: (params: Record<string, any>, instance: FairysPageDataInstance<T>) => Promise<{\n        total: number;\n        list: Record<string, any>[];\n    }>;\n    /**重置获取值的方法*/\n    getResetValues?: (instance: FairysPageDataInstance<T>) => Record<string, any>;\n    constructor(options?: FairysPageDataInstanceOptions);\n    /**更新搜索参数*/\n    onUpdatedSearch: (search: Record<string, any>) => this;\n    /**重置搜索参数*/\n    onResetSearch: (search?: Record<string, any>) => this;\n    /**更新 loading*/\n    updatedLoading: (loading: Record<string, any>) => this;\n    /**更新查询列表 loading*/\n    updatedQueryLoading: (loading?: boolean, tabKey?: string) => this;\n    /**获取查询列表参数*/\n    getQueryListParams: () => Record<string, any> \n    /**查询列表数据*/\n    queryList: () => Promise<void>;\n    /**分页*/\n    onUpdatedPage: (page: number, pageSize?: number) => this;\n    /**更新选择行数据*/\n    onUpdatedSelected: (selectedRows: any[], selectedRowKeys: React.Key[]) => this;\n}\n/**\n * 初始化实例\n */\nexport declare const useFairysPageDataInstance: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState>(options?: FairysPageDataInstanceOptions) => FairysPageDataInstance<T>;\n/**\n * 页面实例上下文\n */\nexport declare const FairysPageDataInstanceContext: import(\"react\").Context<any>;\n/**\n * 页面实例上下文解析\n * @returns 页面实例上下文\n */\nexport declare const useFairysPageDataInstanceContext: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>() => M;\n/**\n * 页面实例状态解析\n * @param options useSnapshot参数选项\n * @returns [页面实例状态, 页面实例]\n */\nexport declare const useFairysPageDataInstanceStore: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>(options?: {\n    sync?: boolean;\n}) => [T, M];\n/**\n * 页面实例表格属性解析\n * @param options useSnapshot参数选项\n * @returns 页面实例表格属性\n */\nexport declare const useFairysPageDataInstanceTableProps: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>(options?: {\n    sync?: boolean;\n}) => {\n    isTabTable: boolean;\n    tabKey: string;\n    dataList: Record<string, any>[];\n    page: number;\n    pageSize: number;\n    total: number;\n    selectedRows: any[];\n    selectedRowKeys: import(\"react\").Key[];\n    loading: boolean;\n};\n/**\n * 页面实例搜索属性解析\n * @param options useSnapshot参数选项\n * @returns 页面实例搜索属性\n */\nexport declare const useFairysPageDataInstanceSearchProps: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>(options?: {\n    sync?: boolean;\n}) => {\n    isTabSearch: boolean;\n    tabKey: string;\n    search: Record<string, any>;\n};\n/**\n * 页面实例编辑表单属性解析\n * @param options useSnapshot参数选项\n * @returns 页面实例编辑表单属性\n */\nexport declare const useFairysPageDataInstanceEditFormProps: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>(options?: {\n    sync?: boolean;\n}) => {\n    editVisible: boolean;\n    editType: string;\n    editFormData: Record<string, any>;\n};\n/**\n * 页面实例状态解析\n * @param instance 页面实例\n * @returns 页面实例状态\n */\nexport declare const useFairysPageDataInstanceSnapshot: <T extends FairysPageDataInstanceState = FairysPageDataInstanceState, M extends FairysPageDataInstance<T> = FairysPageDataInstance<T>>(instance: M) => {\n    isTabTable: boolean;\n    tabKey: string;\n    isTabSearch: boolean;\n    searchTabKey: string;\n    dataList: Record<string, any>[];\n    page: number;\n    pageSize: number;\n    total: number;\n    selectedRows: any[];\n    selectedRowKeys: import(\"react\").Key[];\n    loading: boolean;\n    search: Record<string, any>;\n};\n```\n","routePath":"/hooks/page.data.instance/","lang":"zh","toc":[{"id":"安装","text":"安装","depth":2,"charIndex":0},{"id":"引入","text":"引入","depth":2,"charIndex":97},{"id":"类型","text":"类型","depth":2,"charIndex":464}],"frontmatter":{},"version":""},{"title":"使用","content":"## 基础使用\n\n```tsx\n\n\nimport {\n  useFairysPageDataInstance,\n  FairysPageDataInstanceContext,\n  useFairysPageDataInstanceSnapshot,\n} from '@fairys/hooks';\n\n\n\nconst MainIndex = () => {\n  const [form] = Form.useForm();\n  const pageDataInstance = useFairysPageDataInstance({\n    getList: async (params) => {\n      console.log('打印查询参数', params);\n      await new Promise((resolve) => setTimeout(resolve, 3000));\n      return Promise.resolve({\n        total: 100,\n        list: Array.from({ length: 20 }, (_, i) => ({\n          name: `姓名${i + 1 + (params.page - 1) * params.pageSize}`,\n          age: 20 + i,\n        })),\n      });\n    },\n  });\n\n  const state = useFairysPageDataInstanceSnapshot(pageDataInstance);\n  console.log('state-page', state, pageDataInstance);\n\n  useEffect(() => {\n    pageDataInstance.onUpdatedPage(1);\n  }, []);\n\n  return (\n    <FairysPageDataInstanceContext.Provider value={pageDataInstance}>\n      <FairysMainPage>\n        <FairysMainPageSearch>\n          <Form\n            form={form}\n            initialValues={state.search}\n            onValuesChange={(values) => {\n              pageDataInstance.onUpdatedSearch(values);\n            }}\n            layout=\"inline\"\n          >\n            <Form.Item label=\"姓名\" name=\"name\">\n              <Input />\n            </Form.Item>\n            <Form.Item label=\"年龄\" name=\"age\">\n              <Input />\n            </Form.Item>\n            <Form.Item>\n              <Button type=\"primary\" onClick={() => pageDataInstance.onUpdatedPage(1)}>\n                查询\n              </Button>\n            </Form.Item>\n          </Form>\n        </FairysMainPageSearch>\n        <FairysMainPageBody>\n          <Table\n            loading={!!state.loading}\n            rowKey=\"name\"\n            columns={[\n              {\n                title: '姓名',\n                dataIndex: 'name',\n                key: 'name',\n              },\n              {\n                title: '年龄',\n                dataIndex: 'age',\n                key: 'age',\n              },\n            ]}\n            dataSource={state.dataList}\n            pagination={{\n              total: state.total,\n              current: state?.page || 1,\n              pageSize: state?.pageSize || 20,\n              onChange(page, pageSize) {\n                pageDataInstance.onUpdatedPage(page, pageSize);\n              },\n            }}\n          />\n        </FairysMainPageBody>\n        <FairysMainPageFooter>\n          <Button\n            type=\"primary\"\n            onClick={() => {\n              form.setFieldsValue({\n                name: undefined,\n                age: undefined,\n              });\n              pageDataInstance.onResetSearch({\n                name: undefined,\n                age: undefined,\n              });\n            }}\n          >\n            重置\n          </Button>\n        </FairysMainPageFooter>\n      </FairysMainPage>\n    </FairysPageDataInstanceContext.Provider>\n  );\n};\nexport default MainIndex;\n```\n\n## 重写实例\n\n```tsx\n\n\nimport {\n  FairysPageDataInstanceContext,\n  useFairysPageDataInstanceSnapshot,\n  FairysPageDataInstance,\n  type FairysPageDataInstanceOptions,\n  type FairysPageDataInstanceState,\n} from '@fairys/hooks';\n\n\n\n\ninterface FairysPageDataInstanceCustomState extends FairysPageDataInstanceState {\n  editType?: 'add' | 'edit';\n  editFormData?: Record<string, any>;\n  editVisible?: boolean;\n}\n\nclass FairysPageDataInstanceCustom extends FairysPageDataInstance<FairysPageDataInstanceCustomState> {\n  /**重写父级的默认状态*/\n  get defaultStore(): FairysPageDataInstanceCustomState {\n    return {\n      ...super.defaultStore,\n      editType: 'add',\n      editFormData: this.ref({}),\n      editVisible: false,\n    };\n  }\n\n  /**编辑*/\n  onEditOrAdd = (type: FairysPageDataInstanceCustomState['editType'], formData?: Record<string, any>) => {\n    this.store.editFormData = this.ref(formData || {});\n    this.store.editType = type;\n    this.store.editVisible = true;\n  };\n}\n\nconst useFairysPageDataInstanceCustom = (options: FairysPageDataInstanceOptions) => {\n  const ref = useRef<FairysPageDataInstanceCustom>();\n  if (!ref.current) {\n    // 不存在的时候才进行初始化\n    ref.current = new FairysPageDataInstanceCustom(options);\n  }\n  return ref.current;\n};\n\nconst MainIndex = () => {\n  const [form] = Form.useForm();\n  const pageDataInstance = useFairysPageDataInstanceCustom({\n    getList: async (params) => {\n      console.log('打印查询参数', params);\n      await new Promise((resolve) => setTimeout(resolve, 3000));\n      return Promise.resolve({\n        total: 100,\n        list: Array.from({ length: 20 }, (_, i) => ({\n          name: `姓名${i + 1 + (params.page - 1) * params.pageSize}`,\n          age: 20 + i,\n        })),\n      });\n    },\n  });\n\n  const state = useFairysPageDataInstanceSnapshot(pageDataInstance);\n  console.log('state-custom', state, pageDataInstance);\n  const customState = useSnapshot(pageDataInstance.store);\n\n  console.log('customState-edit数据', customState.editFormData, customState.editType, customState.editVisible);\n\n  useEffect(() => {\n    pageDataInstance.onUpdatedPage(1);\n  }, []);\n\n  return (\n    <FairysPageDataInstanceContext.Provider value={pageDataInstance}>\n      <FairysMainPage>\n        <FairysMainPageSearch>\n          <Form\n            form={form}\n            initialValues={state.search}\n            onValuesChange={(values) => {\n              pageDataInstance.onUpdatedSearch(values);\n            }}\n            layout=\"inline\"\n          >\n            <Form.Item label=\"姓名\" name=\"name\">\n              <Input />\n            </Form.Item>\n            <Form.Item label=\"年龄\" name=\"age\">\n              <Input />\n            </Form.Item>\n            <Form.Item>\n              <Button type=\"primary\" onClick={() => pageDataInstance.onUpdatedPage(1)}>\n                查询\n              </Button>\n              <Button\n                onClick={() => {\n                  form.setFieldsValue({\n                    name: undefined,\n                    age: undefined,\n                  });\n                  pageDataInstance.onResetSearch({\n                    name: undefined,\n                    age: undefined,\n                  });\n                }}\n              >\n                重置\n              </Button>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  pageDataInstance.onEditOrAdd('add');\n                }}\n              >\n                新增\n              </Button>\n            </Form.Item>\n          </Form>\n        </FairysMainPageSearch>\n        <FairysMainPageBody>\n          <Table\n            loading={!!state.loading}\n            rowKey=\"name\"\n            columns={[\n              {\n                title: '操作',\n                dataIndex: 'operation',\n                key: 'operation',\n                width: 120,\n                fixed: 'right',\n                render: (_, record) => (\n                  <>\n                    <Button onClick={() => pageDataInstance.onEditOrAdd('edit', record)}>编辑</Button>\n                  </>\n                ),\n              },\n              {\n                title: '姓名',\n                dataIndex: 'name',\n                key: 'name',\n              },\n              {\n                title: '年龄',\n                dataIndex: 'age',\n                key: 'age',\n              },\n            ]}\n            dataSource={state.dataList}\n            pagination={{\n              total: state.total,\n              current: state?.page || 1,\n              pageSize: state?.pageSize || 20,\n              onChange(page, pageSize) {\n                pageDataInstance.onUpdatedPage(page, pageSize);\n              },\n            }}\n          />\n        </FairysMainPageBody>\n      </FairysMainPage>\n    </FairysPageDataInstanceContext.Provider>\n  );\n};\n\nexport default MainIndex;\n```\n","routePath":"/hooks/page.data.instance/use","lang":"zh","toc":[{"id":"基础使用","text":"基础使用","depth":2,"charIndex":0},{"id":"重写实例","text":"重写实例","depth":2,"charIndex":2942}],"frontmatter":{},"version":""}]